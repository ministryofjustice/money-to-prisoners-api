
{% load static %}
{% load credit %}
{% load i18n %}

<html>

  <head>
    <script src="https://www.google.com/jsapi" type="text/javascript"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

   <link href="{% static 'stylesheets/the_dashboard.css' %}" type="text/css" media="all" rel="stylesheet" />

    <title>Google Charts Example</title>

    <script>
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(drawChartTransaction);
        google.charts.setOnLoadCallback(drawChartAmount);
        google.charts.setOnLoadCallback(drawDonut);
        google.charts.setOnLoadCallback(drawWeeklySatisfaction);
        google.charts.setOnLoadCallback(drawMonthlySatisfaction);
        google.charts.setOnLoadCallback(drawYearlySatisfaction);
        ;

        function drawChartTransaction() {
          var data = google.visualization.arrayToDataTable([
            ['Month', 'Debit', 'BankTransfer', 'Post'],
            {% for d in data reversed %}
              ['{{d.start_of_month|date:"F Y"}}', {{d.credit_count}}, {{d.transaction_count}}, {{d.transaction_by_post}}],
            {% endfor %}
            ]);

          var options = {
            vAxis: { title: 'Transactions'},
            backgroundColor: '#E4E4E4',
            width: 650,
            height: 340,
            bar: {groupWidth: "85%"},
            legend: { position: 'right' },
              };

          var chart = new google.visualization.ColumnChart(document.getElementById('transaction_bar_chart'));
          chart.draw(data, options);
            }

            function drawChartAmount() {
              var data = google.visualization.arrayToDataTable([
                ['Month', 'Debit', 'Bank transfer'],
                {% for d in data reversed %}
                  ['{{d.start_of_month|date:"F Y"}}', {{d.queryset_credit_amount}}, {{d.queryset_transaction_amount}}],
                {% endfor %}
                ]);

              var options = {
                vAxis: { title: 'Money (£)'},
                backgroundColor: '#E4E4E4',
                width: 650,
                height: 340,
                bar: {groupWidth: "85%"},
                legend: { position: "none" },
                  };



              var chart = new google.visualization.ColumnChart(document.getElementById('transaction_bar_chart_of_amount'));
              chart.draw(data, options);
                }


            function drawDonut()  {
              var data = google.visualization.arrayToDataTable([
                ['Sent Money', 'Number'],
                ['Debit', {{this_month_credit}}],
                ['Bank Transfer', {{this_months_transaction}}],
                ['Post', {{this_months_transaction_by_post}}],
              ]);

              var options = {
                title: '{{current_formated_month}} uptake',
                fontSize: 16,
                backgroundColor: '#E4E4E4',
                width: 300,
                height: 300,
                pieHole: 0.4,
                legend: { position: "none" },
                is3D: true
              };

              var chart = new google.visualization.PieChart(document.getElementById('donut_of_transaction'));
              chart.draw(data, options);
            }


            function drawWeeklySatisfaction() {
              var data = google.visualization.arrayToDataTable([
                ["Ratings", "Vote", { role: "style" } ],
                ["Rating 1", {{user_satisfaction.weekly_ratings.rating_1}}, "green"],
                ["Rating 2", {{user_satisfaction.weekly_ratings.rating_2}}, "purple"],
                ["Rating 3", {{user_satisfaction.weekly_ratings.rating_3}}, "gold"],
                ["Rating 4", {{user_satisfaction.weekly_ratings.rating_4}}, "red"],
                ["Rating 5", {{user_satisfaction.weekly_ratings.rating_1}}, "blue"]
              ]);

            var view = new google.visualization.DataView(data);
            view.setColumns([0, 1,
                             { calc: "stringify",
                               sourceColumn: 1,
                               type: "string",
                               role: "annotation" },
                             2]);

            var options = {
              width: 560,
              height: 340,
              backgroundColor: '#E4E4E4',
              title: "Week",
              bar: {groupWidth: "95%"},
              legend: { position: "none" },
            };
            var chart = new google.visualization.ColumnChart(document.getElementById('satisfaction_week_bar_chart'));
            chart.draw(view, options);
          }

          function drawMonthlySatisfaction() {
              var data = google.visualization.arrayToDataTable([
                ["Ratings", "Vote", { role: "style" } ],
                ["Rating 1", {{user_satisfaction.monthly_ratings.rating_1}}, "green"],
                ["Rating 2", {{user_satisfaction.monthly_ratings.rating_2}}, "purple"],
                ["Rating 3", {{user_satisfaction.monthly_ratings.rating_3}}, "gold"],
                ["Rating 4", {{user_satisfaction.monthly_ratings.rating_4}}, "red"],
                ["Rating 5", {{user_satisfaction.monthly_ratings.rating_1}}, "blue"]
              ]);

            var view = new google.visualization.DataView(data);
            view.setColumns([0, 1,
                             { calc: "stringify",
                               sourceColumn: 1,
                               type: "string",
                               role: "annotation" },
                             2]);

            var options = {
              width: 560,
              height: 340,
              backgroundColor: '#E4E4E4',
              title: "Month",
              bar: {groupWidth: "95%"},
              legend: { position: "none" },
            };
            var chart = new google.visualization.ColumnChart(document.getElementById('satisfaction_month_bar_chart'));
            chart.draw(view, options);
          }

          function drawYearlySatisfaction() {
              var data = google.visualization.arrayToDataTable([
                ["Ratings", "Vote", { role: "style" } ],
                ["Rating 1", {{user_satisfaction.yearly_ratings.rating_1}}, "green"],
                ["Rating 2", {{user_satisfaction.yearly_ratings.rating_2}}, "purple"],
                ["Rating 3", {{user_satisfaction.yearly_ratings.rating_3}}, "gold"],
                ["Rating 4", {{user_satisfaction.yearly_ratings.rating_4}}, "red"],
                ["Rating 5", {{user_satisfaction.yearly_ratings.rating_1}}, "blue"]
              ]);

            var view = new google.visualization.DataView(data);
            view.setColumns([0, 1,
                             { calc: "stringify",
                               sourceColumn: 1,
                               type: "string",
                               role: "annotation" },
                             2]);

            var options = {
              width: 560,
              height: 340,
              backgroundColor: '#E4E4E4',
              title: "Year",
              bar: {groupWidth: "95%"},
              legend: { position: "none" },
              // legend: { position: "right" },
            };
            var chart = new google.visualization.ColumnChart(document.getElementById('satisfaction_year_bar_chart'));
            chart.draw(view, options);
          }
        </script>
  </head>
<body>
  <h1 class="main-title" align="center">Analytics Dashboard - MTP</h1>
  <table>
    <thead class="color_div_one">
      <tr class="height_top_and_bottom">
        <td class="three" colspan="4" align="center">
          <div><h2>Number of monthly transactions</h2></div>
          <div align="right" id="transaction_bar_chart" ></div>
        </td>
        <td colspan="2" align ='right'>
          <div><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAJiSURBVGhD7dg7aNVQHMfx67OtDxC0VCgUFMRFQdDBwQcdFEQRHcRNnJzaoVAHhy6iIg46iOAmONhFFAcHUURFcNDJRbAq6qAgFm3B+qqP7+9KIFz+bU6Sk+QeyQ8+0FzoOflxc5OT06hT5/9IN5b8+zPsbMEzrGseBRwV+YMvOKwPQk1UJHIJixBcWovIU6xBULGKyAQOIJjMVCRyHh1o+yQVkcdYhbaOSxH5hH1o27gWkd84iwVoq+iEdsE66dk8Qh9KzTxswCAu4g7eQg9A6yRdfcRuFJpO7McoJmGdiA+61E5jPrxmJU5iHNbERbkHzZ07i3ECU7AmKsN79CNzduINrMHLNo0RzIVz9CM+jl+wBq3SLSxFYhbiKqxBqvYNA0iMlti3YQ1StVfYhMTocroBa5CqXccyOOUMrEGq9ANDmAOnaCmhB5A1WFV0t9wM5+grewdrsKz04qQTeRn7LI2bWI5UuQBrsCTfcR/ncARb0YP4fT7N6lcyPSuUtfgJa1CLlicqvgcu+1VpiuR6el+BNWgrvcUdQhfSxLXIXWReT+kfk76N59BKN2uSimjloBWEbv2ZcwzW4KJrVRPkXULPVuQDtJbLFf2Y9KS0JtC1ug0+MlORB+hF7myHNcELrIavtBbx/rJ0CvEJ5DW8vMDEEi+inZK98JoniJf4jPXwnahIIXtXK9D6nnEQRURFCttN3IF4CW0iFJVct9WkHEVUQu/hpe8h+cplREW03Ag2WuhFRYr4gZeWMajEw+ZRwNGtVkWGm0cB5ytUZGPzKOBcg3ZKtO1Tp06dOnVKSKPxF7AXjySxa3hBAAAAAElFTkSuQmCC"></div>
        </td>
        <td colspan="4" align='left'>
          <div id="donut_of_transaction"></div>
        </td>
        <td colspan="4" align="center">
          <div><h2>Amount of money credited</h2></div>
          <div id="transaction_bar_chart_of_amount" ></div>
        </td>
      </tr>
  </thead>

  <thead>
      <tr class="two" align="center">
        <td colspan="6">
          <table id="t01" align="right">
            <tr class="two">
              <td colspan="1">
                <div class="error_messages">
                  <h1>BACS error rate:</h1>
                </div>
                <div>
                  <h1 class="error-message-margin" >{{current_formated_month}}:  <span style="color:red;font-weight:bold">
                  {% if this_months_pecentage_of_errors > last_months_percentage_of_errors %}
                  {{this_months_pecentage_of_errors}}% +
                  {% elif this_months_pecentage_of_errors < last_months_percentage_of_errors %}
                  {{this_months_pecentage_of_errors}}% -
                  {% endif %}</span>
                  </h1>
                </div>
                <div>
                  <h1 class="error-message-margin">{{current_month_previous_year}}: <span style="color:red;font-weight:bold">
                 {{last_year_same_time_percentage_of_errors}}% </span>
                 </h1>
                </div>
              </td>
          </table>
        <td colspan="6">
          <h2 class="savings">£10m Saved</h2>
        </td>
      </tr>
    </thead>

    <thead class='color_div_one height_top_and_bottom'>
     <tr align="center" class="one">
       <td colspan="12">
         <h1>User satisfaction rate</h1>
       </td>
     </tr>
      <tr align="center" class="three height_top_and_bottom">
        <td colspan="4">
          <div><h3>By week</h3></div>
          <div id="satisfaction_week_bar_chart"></div>
        </td>
        <td colspan="4">
          <div><h3>By month</h3></div>
          <div id="satisfaction_month_bar_chart"></div>
        </td>
        <td colspan="4">
          <div><h3>By year</h3></div>
          <div id="satisfaction_year_bar_chart"></div>
        </td>
      </tr>
    </thead>

  </table>
</body>

